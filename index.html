<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DivertScan Test</title>
<style>
body{font-family:sans-serif;background:#0f172a;color:#f1f5f9;padding:20px;text-align:center}
.box{background:#1e293b;border-radius:12px;padding:20px;margin:20px auto;max-width:400px}
.btn{background:#10b981;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:16px;cursor:pointer;margin:10px}
#status{margin:20px 0;padding:15px;border-radius:8px;background:#334155}
.error{background:#7f1d1d !important;color:#fecaca}
.success{background:#14532d !important;color:#bbf7d0}
</style>
</head>
<body>
<div class="box">
<h1>♻️ DivertScan</h1>
<h2>Connection Test</h2>
<div id="status">Loading...</div>
<button class="btn" onclick="testConnection()">Test Again</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL='https://tkcrnfgnspvaefrqfxgr.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRrY3JuZmduc3B2YWVmcnFmeGdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4NjI0NjIsImV4cCI6MjA1MzQzODQ2Mn0.L0dKz9T_ynvmKAFIoEsdHZ2o3KSqgmLFGNBCEaFBfJY';

function log(msg, isError) {
    const el = document.getElementById('status');
    el.innerHTML += '<br>' + msg;
    if(isError) el.className = 'error';
}

async function testConnection() {
    const el = document.getElementById('status');
    el.innerHTML = 'Starting test...';
    el.className = '';
    
    try {
        log('1. Creating Supabase client...');
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        log('✓ Client created');
        
        log('2. Testing auth.getSession()...');
        const {data, error} = await supabase.auth.getSession();
        
        if(error) {
            log('✗ Auth error: ' + error.message, true);
            return;
        }
        
        log('✓ Auth works!');
        
        if(data.session) {
            log('✓ User logged in: ' + data.session.user.email);
        } else {
            log('→ No active session (not logged in)');
        }
        
        log('3. Testing database connection...');
        const {data: projects, error: dbError} = await supabase.from('projects').select('count');
        
        if(dbError) {
            log('✗ DB error: ' + dbError.message, true);
            return;
        }
        
        log('✓ Database connected!');
        el.className = 'success';
        log('<br><b>ALL TESTS PASSED</b>');
        
    } catch(e) {
        log('✗ Exception: ' + e.message, true);
    }
}

// Run on load
testConnection();
</script>
</body>
</html>
