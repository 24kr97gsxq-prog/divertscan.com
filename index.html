<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>DivertScan‚Ñ¢ | LEED v5 Carbon Auditor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%2310b981' rx='20' width='100' height='100'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>‚ôª</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        :root{--slate-900:#0f172a;--slate-800:#1e293b;--slate-700:#334155;--slate-600:#475569;--slate-500:#64748b;--slate-400:#94a3b8;--slate-300:#cbd5e1;--emerald-500:#10b981;--emerald-400:#34d399;--emerald-600:#059669;--sky-500:#0ea5e9;--sky-400:#38bdf8;--amber-500:#f59e0b;--amber-600:#d97706;--red-500:#ef4444;--purple-500:#8b5cf6;--purple-600:#7c3aed}
        html{font-family:'DM Sans',system-ui,sans-serif;background:linear-gradient(135deg,var(--slate-900),var(--slate-800));min-height:100vh}
        body{min-height:100vh;color:#fff}
        .hidden{display:none!important}
        
        /* Loading */
        .loading-screen{position:fixed;inset:0;background:var(--slate-900);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
        .loading-logo{width:64px;height:64px;background:var(--emerald-500);border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:16px}
        .loading-logo svg{width:40px;height:40px;color:#fff}
        .loading-text{font-size:24px;font-weight:700}
        .loading-spinner{width:32px;height:32px;border:3px solid var(--slate-700);border-top-color:var(--emerald-500);border-radius:50%;animation:spin 1s linear infinite;margin-top:24px}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* Auth */
        .auth-screen{min-height:100vh;padding:24px;display:flex;align-items:center;justify-content:center}
        .auth-card{background:rgba(30,41,59,0.8);backdrop-filter:blur(10px);border-radius:24px;padding:32px;width:100%;max-width:400px;border:1px solid var(--slate-700)}
        .auth-logo{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:8px}
        .auth-logo-icon{width:48px;height:48px;background:var(--emerald-500);border-radius:12px;display:flex;align-items:center;justify-content:center}
        .auth-logo-icon svg{width:28px;height:28px;color:#fff}
        .auth-logo-text{font-size:28px;font-weight:700}
        .auth-tagline{text-align:center;color:var(--emerald-400);font-size:14px;margin-bottom:32px}
        .auth-title{font-size:20px;font-weight:600;text-align:center;margin-bottom:24px}
        .auth-error{background:rgba(239,68,68,0.2);border:1px solid var(--red-500);color:#f87171;padding:12px;border-radius:8px;font-size:14px;margin-bottom:16px;display:none}
        .auth-error.show{display:block}
        .auth-switch{text-align:center;margin-top:20px;color:var(--slate-400);font-size:14px}
        .auth-switch a{color:var(--emerald-400);text-decoration:none;font-weight:600}
        
        /* Forms */
        .form-group{margin-bottom:16px}
        .form-label{display:block;color:var(--slate-400);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px}
        .form-input{width:100%;padding:14px 16px;background:var(--slate-800);border:1px solid var(--slate-600);border-radius:12px;color:#fff;font-size:16px;outline:none}
        .form-input:focus{border-color:var(--emerald-500)}
        .form-input::placeholder{color:var(--slate-500)}
        
        /* Buttons */
        .btn-primary{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--emerald-500),var(--emerald-600));color:#fff;font-weight:700;font-size:14px;cursor:pointer;margin-top:16px}
        .btn-primary:disabled{opacity:0.5;cursor:not-allowed}
        .btn-secondary{width:100%;padding:14px;border:1px solid var(--slate-600);border-radius:12px;background:transparent;color:var(--slate-300);font-weight:600;font-size:14px;cursor:pointer;margin-top:8px}
        
        /* App */
        .app{display:none}
        .app.active{display:block}
        
        /* Nav */
        .nav{background:rgba(15,23,42,0.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--slate-700);padding:12px 16px;position:sticky;top:0;z-index:100}
        .nav-content{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:0 auto}
        .nav-brand{display:flex;align-items:center;gap:8px}
        .nav-logo{width:32px;height:32px;background:var(--emerald-500);border-radius:8px;display:flex;align-items:center;justify-content:center}
        .nav-logo svg{width:20px;height:20px;color:#fff}
        .nav-title{font-size:18px;font-weight:700}
        .nav-actions{display:flex;align-items:center;gap:12px}
        .nav-btn{padding:8px 12px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;background:var(--slate-700);color:var(--slate-300)}
        .nav-btn svg{width:16px;height:16px}
        .nav-btn.danger{background:transparent;color:var(--slate-400)}
        .nav-btn.danger:hover{color:var(--red-500)}
        
        /* Project Selector */
        .project-selector{background:var(--slate-700);border:1px solid var(--slate-600);border-radius:8px;padding:8px 12px;color:#fff;font-size:14px;min-width:180px}
        
        /* Tabs */
        .tabs{display:flex;gap:4px;padding:12px 16px;background:var(--slate-800);overflow-x:auto}
        .tab{padding:10px 16px;border:none;border-radius:8px;background:transparent;color:var(--slate-400);font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap}
        .tab.active{background:var(--slate-700);color:#fff}
        
        /* Main */
        .main{padding:16px;max-width:1200px;margin:0 auto}
        .page{display:none}
        .page.active{display:block}
        
        /* Cards */
        .card{background:rgba(30,41,59,0.5);backdrop-filter:blur(10px);border-radius:16px;padding:20px;margin-bottom:16px;border:1px solid rgba(51,65,85,0.5)}
        .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
        .card-title{font-size:14px;font-weight:600;color:var(--slate-300)}
        .card-subtitle{font-size:11px;color:var(--slate-500);text-transform:uppercase;letter-spacing:0.5px}
        
        /* Stats */
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}
        @media(min-width:640px){.stats-grid{grid-template-columns:repeat(4,1fr)}}
        .stat-card{background:rgba(15,23,42,0.5);border-radius:12px;padding:16px;border:1px solid var(--slate-700)}
        .stat-label{font-size:11px;color:var(--slate-500);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px}
        .stat-value{font-size:24px;font-weight:700}
        .stat-value.emerald{color:var(--emerald-400)}
        .stat-value.sky{color:var(--sky-400)}
        .stat-value.amber{color:var(--amber-500)}
        .stat-value.purple{color:var(--purple-500)}
        
        /* Button Grid */
        .button-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}
        .action-btn{border:none;font-weight:700;padding:20px 16px;border-radius:16px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:8px;color:#fff}
        .action-btn:active{transform:scale(0.96)}
        .action-btn svg{width:32px;height:32px}
        .action-btn span{font-size:12px;text-transform:uppercase;letter-spacing:0.5px}
        .action-btn.scan{background:linear-gradient(135deg,var(--emerald-500),var(--emerald-600));box-shadow:0 8px 24px rgba(16,185,129,0.3)}
        .action-btn.upload{background:linear-gradient(135deg,var(--amber-500),var(--amber-600));box-shadow:0 8px 24px rgba(245,158,11,0.3)}
        .action-btn.generate{background:linear-gradient(135deg,var(--sky-500),#0284c7);box-shadow:0 8px 24px rgba(14,165,233,0.3)}
        .action-btn.add{background:linear-gradient(135deg,var(--purple-500),var(--purple-600));box-shadow:0 8px 24px rgba(139,92,246,0.3)}
        
        /* List Items */
        .list-item{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(15,23,42,0.5);border-radius:12px;margin-bottom:8px;border:1px solid var(--slate-700);cursor:pointer}
        .list-item:hover{border-color:var(--slate-600)}
        .list-item-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .list-item-icon svg{width:20px;height:20px}
        .list-item-icon.emerald{background:rgba(16,185,129,0.2);color:var(--emerald-400)}
        .list-item-icon.sky{background:rgba(14,165,233,0.2);color:var(--sky-400)}
        .list-item-icon.purple{background:rgba(139,92,246,0.2);color:var(--purple-500)}
        .list-item-content{flex:1;min-width:0}
        .list-item-title{font-weight:600;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .list-item-subtitle{font-size:12px;color:var(--slate-500)}
        .list-item-meta{text-align:right}
        .list-item-value{font-weight:700;font-size:14px;color:var(--emerald-400)}
        .list-item-label{font-size:11px;color:var(--slate-500)}
        
        /* Gauge */
        .gauge-container{display:flex;justify-content:center;padding:20px 0}
        .gauge{position:relative;width:180px;height:180px}
        .gauge svg{width:100%;height:100%;transform:rotate(-90deg)}
        .gauge-bg{fill:none;stroke:var(--slate-700);stroke-width:12}
        .gauge-progress{fill:none;stroke:url(#gaugeGradient);stroke-width:12;stroke-linecap:round;transition:stroke-dashoffset 1.5s}
        .gauge-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
        .gauge-value{font-size:32px;font-weight:700}
        .gauge-unit{color:var(--slate-400);font-size:12px}
        .gauge-percent{color:var(--emerald-400);font-size:11px;margin-top:4px}
        
        /* Empty State */
        .empty-state{text-align:center;padding:40px 20px;color:var(--slate-500)}
        .empty-state svg{width:48px;height:48px;margin-bottom:16px;opacity:0.5}
        .empty-state-title{font-size:16px;font-weight:600;color:var(--slate-400);margin-bottom:8px}
        
        /* Modal */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:2000;padding:16px}
        .modal-overlay.show{display:flex}
        .modal{background:var(--slate-800);border-radius:24px;padding:24px;max-width:500px;width:100%;max-height:85vh;overflow-y:auto;border:1px solid var(--slate-700)}
        .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
        .modal-title{font-size:18px;font-weight:700}
        .modal-close{width:32px;height:32px;border:none;background:var(--slate-700);border-radius:8px;color:var(--slate-400);cursor:pointer;display:flex;align-items:center;justify-content:center}
        
        /* Scan Result */
        .scan-result{margin-top:16px}
        .scan-result-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--slate-700)}
        .scan-result-item:last-child{border-bottom:none}
        .scan-result-label{color:var(--slate-400);font-size:13px}
        .scan-result-value{font-weight:600;font-size:14px}
        .preview-container{margin:16px 0;text-align:center}
        .preview-image{max-width:100%;max-height:200px;border-radius:12px}
        .analyzing-text{color:var(--sky-400);font-size:14px;margin-top:12px}
        
        /* Toast */
        .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--slate-800);border:1px solid var(--slate-700);padding:12px 20px;border-radius:12px;font-size:14px;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,0.4);opacity:0;transition:all 0.3s;z-index:3000}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast.success{border-color:var(--emerald-500);color:var(--emerald-400)}
        .toast.error{border-color:var(--red-500);color:var(--red-500)}
        .toast.info{border-color:var(--sky-500);color:var(--sky-400)}
        
        /* Badge */
        .badge{display:inline-block;padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase}
        .badge.active{background:rgba(16,185,129,0.2);color:var(--emerald-400)}
        .badge.planning{background:rgba(245,158,11,0.2);color:var(--amber-500)}
        .badge.completed{background:rgba(14,165,233,0.2);color:var(--sky-400)}
        
        #cameraInput,#fileInput{display:none}
        .footer{text-align:center;padding:24px;color:var(--slate-600);font-size:11px}
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div>
        <div class="loading-text">DivertScan‚Ñ¢</div>
        <div class="loading-spinner"></div>
    </div>

    <div class="auth-screen hidden" id="authScreen">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="auth-logo-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div>
                <span class="auth-logo-text">DivertScan‚Ñ¢</span>
            </div>
            <p class="auth-tagline">LEED v5 MRp2 Carbon Auditor</p>
            <h2 class="auth-title" id="authTitle">Sign In</h2>
            <div class="auth-error" id="authError"></div>
            <form id="authForm">
                <div class="form-group hidden" id="nameGroup">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="authName" placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="authEmail" placeholder="you@company.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="authPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <button type="submit" class="btn-primary" id="authSubmit">Sign In</button>
            </form>
            <p class="auth-switch"><span id="authSwitchText">Don't have an account?</span> <a href="#" id="authSwitchLink">Sign Up</a></p>
        </div>
    </div>

    <div class="app" id="mainApp">
        <input type="file" id="cameraInput" accept="image/*" capture="environment">
        <input type="file" id="fileInput" accept="image/*">
        
        <nav class="nav">
            <div class="nav-content">
                <div class="nav-brand">
                    <div class="nav-logo"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg></div>
                    <span class="nav-title">DivertScan‚Ñ¢</span>
                </div>
                <div class="nav-actions">
                    <select class="project-selector" id="projectSelector" onchange="switchProject()"><option value="">Select Project...</option></select>
                    <button class="nav-btn danger" onclick="signOut()" title="Sign Out"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg></button>
                </div>
            </div>
        </nav>
        
        <div class="tabs">
            <button class="tab active" onclick="showPage('dashboard')">Dashboard</button>
            <button class="tab" onclick="showPage('scans')">Scans</button>
            <button class="tab" onclick="showPage('projects')">Projects</button>
            <button class="tab" onclick="showPage('customers')">Customers</button>
            <button class="tab" onclick="showPage('settings')">Settings</button>
        </div>
        
        <main class="main">
            <div class="page active" id="page-dashboard">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label">Total CO‚ÇÇe</div><div class="stat-value emerald" id="statCO2e">0.00</div></div>
                    <div class="stat-card"><div class="stat-label">Total Weight</div><div class="stat-value sky" id="statWeight">0 T</div></div>
                    <div class="stat-card"><div class="stat-label">Scans</div><div class="stat-value amber" id="statScans">0</div></div>
                    <div class="stat-card"><div class="stat-label">Diversion</div><div class="stat-value purple" id="statDiversion">0%</div></div>
                </div>
                
                <div class="button-grid">
                    <button class="action-btn scan" onclick="openCamera()"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg><span>Camera Scan</span></button>
                    <button class="action-btn upload" onclick="openFiles()"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Upload from Files</span></button>
                </div>
                <div class="button-grid">
                    <button class="action-btn generate" onclick="generateReport()" style="grid-column:span 2"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg><span>Generate LEED Report</span></button>
                </div>
                
                <div class="card">
                    <div class="card-header"><span class="card-title">Carbon Progress</span><span class="card-subtitle" id="projectTargetLabel">Target: 8,000 MT</span></div>
                    <div class="gauge-container">
                        <div class="gauge">
                            <svg viewBox="0 0 200 200"><defs><linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#10b981"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#ef4444"/></linearGradient></defs><circle class="gauge-bg" cx="100" cy="100" r="85"/><circle class="gauge-progress" id="gaugeProgress" cx="100" cy="100" r="85"/></svg>
                            <div class="gauge-center"><span class="gauge-value" id="gaugeValue">0</span><span class="gauge-unit">MT CO‚ÇÇe</span><span class="gauge-percent" id="gaugePercent">0% of target</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="card"><div class="card-header"><span class="card-title">Recent Scans</span></div><div id="recentScansList"><div class="empty-state"><div class="empty-state-title">No scans yet</div></div></div></div>
            </div>
            
            <div class="page" id="page-scans"><div class="card"><div class="card-header"><span class="card-title">All Scans</span></div><div id="allScansList"></div></div></div>
            
            <div class="page" id="page-projects">
                <div class="button-grid" style="margin-bottom:16px"><button class="action-btn add" onclick="showModal('projectModal')" style="grid-column:span 2"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg><span>New Project</span></button></div>
                <div class="card"><div class="card-header"><span class="card-title">All Projects</span></div><div id="projectsList"></div></div>
            </div>
            
            <div class="page" id="page-customers">
                <div class="button-grid" style="margin-bottom:16px"><button class="action-btn add" onclick="showModal('customerModal')" style="grid-column:span 2"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg><span>New Customer</span></button></div>
                <div class="card"><div class="card-header"><span class="card-title">All Customers</span></div><div id="customersList"></div></div>
            </div>
            
            <div class="page" id="page-settings">
                <div class="card"><div class="card-header"><span class="card-title">API Configuration</span></div><div class="form-group"><label class="form-label">OpenAI API Key</label><input type="password" class="form-input" id="openaiKeyInput" placeholder="sk-..."></div><button class="btn-primary" onclick="saveApiKey()">Save API Key</button></div>
                <div class="card"><div class="card-header"><span class="card-title">Organization</span></div><div class="form-group"><label class="form-label">Organization Name</label><input type="text" class="form-input" id="orgNameInput" placeholder="Your Company"></div><button class="btn-primary" onclick="saveOrgSettings()">Save Settings</button></div>
                <div class="card"><div class="card-header"><span class="card-title">Account</span></div><p style="color:var(--slate-400);font-size:14px;margin-bottom:16px">Signed in as: <strong id="userEmail">‚Äî</strong></p><button class="btn-secondary" onclick="signOut()">Sign Out</button></div>
            </div>
        </main>
        <footer class="footer">DivertScan‚Ñ¢ ¬© 2025 Dalmex Recycling LLC</footer>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="scanModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title" id="scanModalTitle">Analyzing...</h3><button class="modal-close" onclick="closeModal('scanModal')">‚úï</button></div>
            <div class="preview-container" id="previewContainer"><img id="previewImage" class="preview-image" src="" alt="Preview"><p class="analyzing-text" id="analyzingText">üîç Analyzing...</p></div>
            <div class="scan-result" id="scanResult" style="display:none">
                <div class="scan-result-item"><span class="scan-result-label">Material</span><span class="scan-result-value" id="resultMaterial">‚Äî</span></div>
                <div class="scan-result-item"><span class="scan-result-label">Weight</span><span class="scan-result-value" id="resultWeight">‚Äî</span></div>
                <div class="scan-result-item"><span class="scan-result-label">Hauler</span><span class="scan-result-value" id="resultHauler">‚Äî</span></div>
                <div class="scan-result-item"><span class="scan-result-label">Date</span><span class="scan-result-value" id="resultDate">‚Äî</span></div>
                <div class="scan-result-item"><span class="scan-result-label">Ticket #</span><span class="scan-result-value" id="resultTicket">‚Äî</span></div>
                <div class="scan-result-item"><span class="scan-result-label">CO‚ÇÇe</span><span class="scan-result-value" id="resultCO2" style="color:var(--emerald-400)">‚Äî</span></div>
            </div>
            <button class="btn-primary" id="confirmScanBtn" onclick="confirmScan()" style="display:none">‚úì Save to Cloud</button>
            <button class="btn-secondary" onclick="closeModal('scanModal')">Cancel</button>
        </div>
    </div>

    <div class="modal-overlay" id="projectModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">New Project</h3><button class="modal-close" onclick="closeModal('projectModal')">‚úï</button></div>
            <form id="projectForm" onsubmit="saveProject(event)">
                <div class="form-group"><label class="form-label">Project Name *</label><input type="text" class="form-input" id="projectName" required></div>
                <div class="form-group"><label class="form-label">Customer</label><select class="form-input" id="projectCustomer"><option value="">Select...</option></select></div>
                <div class="form-group"><label class="form-label">Address</label><input type="text" class="form-input" id="projectAddress"></div>
                <div class="form-group"><label class="form-label">City</label><input type="text" class="form-input" id="projectCity"></div>
                <div class="form-group"><label class="form-label">State</label><input type="text" class="form-input" id="projectState"></div>
                <div class="form-group"><label class="form-label">LEED Target</label><select class="form-input" id="projectLeedTarget"><option>Certified</option><option>Silver</option><option selected>Gold</option><option>Platinum</option></select></div>
                <div class="form-group"><label class="form-label">Max CO‚ÇÇe (MT)</label><input type="number" class="form-input" id="projectCO2Target" value="8000"></div>
                <button type="submit" class="btn-primary">Create Project</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="customerModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">New Customer</h3><button class="modal-close" onclick="closeModal('customerModal')">‚úï</button></div>
            <form id="customerForm" onsubmit="saveCustomer(event)">
                <div class="form-group"><label class="form-label">Name *</label><input type="text" class="form-input" id="customerName" required></div>
                <div class="form-group"><label class="form-label">Company</label><input type="text" class="form-input" id="customerCompany"></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="customerEmail"></div>
                <div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" id="customerPhone"></div>
                <div class="form-group"><label class="form-label">City</label><input type="text" class="form-input" id="customerCity"></div>
                <div class="form-group"><label class="form-label">State</label><input type="text" class="form-input" id="customerState"></div>
                <button type="submit" class="btn-primary">Create Customer</button>
            </form>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
// ========== CONFIGURATION ==========
const SUPABASE_URL = 'https://cyvvlngtojagfoaitoog.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dnZsbmd0b2phZ2ZvYWl0b29nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkyODk4OTAsImV4cCI6MjA4NDg2NTg5MH0.CltpTET2wFfl5kaHFOGmUS8tR8bRFCjbtWDdVrC5r0g';

let supabase, currentUser = null, currentOrg = null, currentProject = null, materialTypes = [], currentScanResult = null;
let OPENAI_API_KEY = localStorage.getItem('divertscan_openai_key') || '';

const EMISSION_FACTORS = {concrete:0.159,steel:1.85,aluminum:11.89,wood:0.03,drywall:0.12,asphalt:0.05,glass:0.85,plastic:2.5,cardboard:0.94,'mixed c&d':0.15,default:0.15};

// ========== INIT ==========
async function init() {
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const { data: { session } } = await supabase.auth.getSession();
        if (session) { currentUser = session.user; await loadUserData(); showApp(); }
        else { showAuth(); }
    } catch (e) { console.error(e); showAuth(); }
    document.getElementById('loadingScreen').classList.add('hidden');
    document.getElementById('cameraInput').addEventListener('change', handleImageCapture);
    document.getElementById('fileInput').addEventListener('change', handleImageCapture);
    if (OPENAI_API_KEY) document.getElementById('openaiKeyInput').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
}

// ========== AUTH ==========
let isSignUp = false;
function showAuth() { document.getElementById('authScreen').classList.remove('hidden'); document.getElementById('mainApp').classList.remove('active'); }
function showApp() { document.getElementById('authScreen').classList.add('hidden'); document.getElementById('mainApp').classList.add('active'); document.getElementById('userEmail').textContent = currentUser?.email || '‚Äî'; }

document.getElementById('authSwitchLink').addEventListener('click', e => {
    e.preventDefault(); isSignUp = !isSignUp;
    document.getElementById('authTitle').textContent = isSignUp ? 'Create Account' : 'Sign In';
    document.getElementById('authSubmit').textContent = isSignUp ? 'Sign Up' : 'Sign In';
    document.getElementById('authSwitchText').textContent = isSignUp ? 'Already have an account?' : "Don't have an account?";
    document.getElementById('authSwitchLink').textContent = isSignUp ? 'Sign In' : 'Sign Up';
    document.getElementById('nameGroup').classList.toggle('hidden', !isSignUp);
});

document.getElementById('authForm').addEventListener('submit', async e => {
    e.preventDefault();
    const email = document.getElementById('authEmail').value, password = document.getElementById('authPassword').value, name = document.getElementById('authName').value;
    const errorEl = document.getElementById('authError'), btn = document.getElementById('authSubmit');
    btn.disabled = true; btn.textContent = isSignUp ? 'Creating...' : 'Signing in...'; errorEl.classList.remove('show');
    try {
        if (isSignUp) {
            const { data, error } = await supabase.auth.signUp({ email, password, options: { data: { full_name: name } } });
            if (error) throw error;
            if (data.user) { await createDefaultOrg(data.user); currentUser = data.user; await loadUserData(); showApp(); showToast('Account created!', 'success'); }
        } else {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            currentUser = data.user; await loadUserData(); showApp(); showToast('Welcome back!', 'success');
        }
    } catch (err) { errorEl.textContent = err.message; errorEl.classList.add('show'); }
    finally { btn.disabled = false; btn.textContent = isSignUp ? 'Sign Up' : 'Sign In'; }
});

async function createDefaultOrg(user) {
    const { data: org } = await supabase.from('organizations').insert({ name: 'My Organization', slug: user.id.slice(0, 8) }).select().single();
    if (org) await supabase.from('users').update({ organization_id: org.id, role: 'admin' }).eq('id', user.id);
    return org;
}

async function signOut() { await supabase.auth.signOut(); currentUser = currentOrg = currentProject = null; showAuth(); showToast('Signed out', 'info'); }

// ========== DATA ==========
async function loadUserData() {
    const { data: profile } = await supabase.from('users').select('*, organizations(*)').eq('id', currentUser.id).single();
    if (profile?.organizations) { currentOrg = profile.organizations; document.getElementById('orgNameInput').value = currentOrg.name; }
    const { data: materials } = await supabase.from('material_types').select('*');
    materialTypes = materials || [];
    await loadProjects(); await loadCustomers();
}

async function loadProjects() {
    if (!currentOrg) return;
    const { data: projects } = await supabase.from('projects').select('*, customers(name)').eq('organization_id', currentOrg.id).order('created_at', { ascending: false });
    const selector = document.getElementById('projectSelector'), custSelect = document.getElementById('projectCustomer');
    selector.innerHTML = '<option value="">Select Project...</option>';
    (projects || []).forEach(p => selector.innerHTML += `<option value="${p.id}">${p.name}</option>`);
    renderProjectsList(projects || []);
    if (projects?.length && !currentProject) { selector.value = projects[0].id; await switchProject(); }
}

async function loadCustomers() {
    if (!currentOrg) return;
    const { data: customers } = await supabase.from('customers').select('*').eq('organization_id', currentOrg.id).order('name');
    document.getElementById('projectCustomer').innerHTML = '<option value="">Select...</option>' + (customers || []).map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    renderCustomersList(customers || []);
}

async function loadScans() {
    if (!currentProject) return;
    const { data: scans } = await supabase.from('scans').select('*').eq('project_id', currentProject.id).order('created_at', { ascending: false });
    renderRecentScans(scans || []); renderAllScans(scans || []); updateStats(scans || []);
}

async function switchProject() {
    const id = document.getElementById('projectSelector').value;
    if (!id) { currentProject = null; return; }
    const { data } = await supabase.from('projects').select('*').eq('id', id).single();
    currentProject = data;
    document.getElementById('projectTargetLabel').textContent = `Target: ${(data.max_co2e_target || 8000).toLocaleString()} MT`;
    await loadScans();
}

// ========== SAVE ==========
async function saveProject(e) {
    e.preventDefault();
    if (!currentOrg) return showToast('No organization', 'error');
    const project = { organization_id: currentOrg.id, name: document.getElementById('projectName').value, customer_id: document.getElementById('projectCustomer').value || null, address: document.getElementById('projectAddress').value, city: document.getElementById('projectCity').value, state: document.getElementById('projectState').value, leed_certification_target: document.getElementById('projectLeedTarget').value, max_co2e_target: parseFloat(document.getElementById('projectCO2Target').value) || 8000, created_by: currentUser.id };
    const { data, error } = await supabase.from('projects').insert(project).select().single();
    if (error) return showToast('Error: ' + error.message, 'error');
    closeModal('projectModal'); document.getElementById('projectForm').reset(); await loadProjects();
    document.getElementById('projectSelector').value = data.id; await switchProject(); showToast('Project created!', 'success');
}

async function saveCustomer(e) {
    e.preventDefault();
    if (!currentOrg) return showToast('No organization', 'error');
    const customer = { organization_id: currentOrg.id, name: document.getElementById('customerName').value, company: document.getElementById('customerCompany').value, email: document.getElementById('customerEmail').value, phone: document.getElementById('customerPhone').value, city: document.getElementById('customerCity').value, state: document.getElementById('customerState').value, created_by: currentUser.id };
    const { error } = await supabase.from('customers').insert(customer);
    if (error) return showToast('Error: ' + error.message, 'error');
    closeModal('customerModal'); document.getElementById('customerForm').reset(); await loadCustomers(); showToast('Customer created!', 'success');
}

// ========== SCANNING ==========
function openCamera() { if (!checkApiKey()) return; if (!currentProject) return showToast('Select a project first', 'error'); document.getElementById('cameraInput').click(); }
function openFiles() { if (!checkApiKey()) return; if (!currentProject) return showToast('Select a project first', 'error'); document.getElementById('fileInput').click(); }
function checkApiKey() { if (!OPENAI_API_KEY) { showPage('settings'); showToast('Enter OpenAI API key in Settings', 'error'); return false; } return true; }

async function handleImageCapture(e) {
    const file = e.target.files[0]; if (!file) return;
    document.getElementById('scanModalTitle').textContent = 'Analyzing...';
    document.getElementById('previewContainer').style.display = 'block';
    document.getElementById('scanResult').style.display = 'none';
    document.getElementById('confirmScanBtn').style.display = 'none';
    document.getElementById('analyzingText').style.display = 'block';
    document.getElementById('analyzingText').textContent = 'üîç GPT-4 Vision analyzing...';
    const reader = new FileReader(); reader.onload = ev => document.getElementById('previewImage').src = ev.target.result; reader.readAsDataURL(file);
    showModal('scanModal');
    try {
        const base64 = await new Promise((res, rej) => { const r = new FileReader(); r.onload = () => res(r.result.split(',')[1]); r.onerror = rej; r.readAsDataURL(file); });
        const result = await analyzeWithGPT4Vision(base64);
        if (result.success) displayScanResult(result.data); else throw new Error(result.error);
    } catch (err) { document.getElementById('scanModalTitle').textContent = 'Scan Failed'; document.getElementById('analyzingText').textContent = '‚ùå ' + err.message; document.getElementById('analyzingText').style.color = 'var(--red-500)'; }
    e.target.value = '';
}

async function analyzeWithGPT4Vision(base64) {
    const prompt = `Analyze this scale ticket image. Return ONLY JSON: {"material":"type","weight_tons":number,"hauler":"company","date":"YYYY-MM-DD","ticket_number":"number","confidence":"high/medium/low"}`;
    try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${OPENAI_API_KEY}` }, body: JSON.stringify({ model: 'gpt-4o', messages: [{ role: 'user', content: [{ type: 'text', text: prompt }, { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${base64}` } }] }], max_tokens: 500 }) });
        if (!res.ok) { const err = await res.json(); throw new Error(err.error?.message || 'API failed'); }
        const data = await res.json(), match = data.choices[0].message.content.match(/\{[\s\S]*\}/);
        if (!match) throw new Error('Could not parse');
        return { success: true, data: JSON.parse(match[0]) };
    } catch (err) { return { success: false, error: err.message }; }
}

function displayScanResult(data) {
    currentScanResult = data;
    document.getElementById('scanModalTitle').textContent = '‚úì Ticket Scanned';
    document.getElementById('analyzingText').style.display = 'none';
    document.getElementById('scanResult').style.display = 'block';
    document.getElementById('confirmScanBtn').style.display = 'block';
    const mat = (data.material || 'mixed c&d').toLowerCase(), weight = data.weight_tons || 0;
    const mt = materialTypes.find(m => m.name.toLowerCase() === mat), ef = mt?.emission_factor || EMISSION_FACTORS[mat] || EMISSION_FACTORS.default;
    const co2e = (weight * ef).toFixed(4);
    currentScanResult.co2e = parseFloat(co2e); currentScanResult.emission_factor = ef; currentScanResult.material_type_id = mt?.id || null;
    document.getElementById('resultMaterial').textContent = data.material || 'Unknown';
    document.getElementById('resultWeight').textContent = weight ? `${weight} tons` : 'Unknown';
    document.getElementById('resultHauler').textContent = data.hauler || 'Unknown';
    document.getElementById('resultDate').textContent = data.date || new Date().toISOString().split('T')[0];
    document.getElementById('resultTicket').textContent = data.ticket_number || 'N/A';
    document.getElementById('resultCO2').textContent = `+${parseFloat(co2e).toFixed(2)} MT CO‚ÇÇe`;
}

async function confirmScan() {
    if (!currentScanResult || !currentProject) return;
    const scan = { organization_id: currentOrg.id, project_id: currentProject.id, ticket_number: currentScanResult.ticket_number, ticket_date: currentScanResult.date || new Date().toISOString().split('T')[0], material_type_id: currentScanResult.material_type_id, material_name: currentScanResult.material, weight_tons: currentScanResult.weight_tons || 0, co2e_mt: currentScanResult.co2e, emission_factor_used: currentScanResult.emission_factor, hauler_name: currentScanResult.hauler, ai_confidence: currentScanResult.confidence, created_by: currentUser.id };
    const { error } = await supabase.from('scans').insert(scan);
    if (error) return showToast('Error: ' + error.message, 'error');
    closeModal('scanModal'); await loadScans(); showToast('Scan saved!', 'success');
}

// ========== RENDERING ==========
function renderRecentScans(scans) {
    const c = document.getElementById('recentScansList');
    if (!scans.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-title">No scans yet</div></div>'; return; }
    c.innerHTML = scans.slice(0, 5).map(s => `<div class="list-item"><div class="list-item-icon emerald"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div class="list-item-content"><div class="list-item-title">${s.material_name || 'Unknown'}</div><div class="list-item-subtitle">${s.weight_tons || 0} tons ‚Ä¢ ${s.hauler_name || 'Unknown'}</div></div><div class="list-item-meta"><div class="list-item-value">+${(s.co2e_mt || 0).toFixed(2)}</div><div class="list-item-label">MT CO‚ÇÇe</div></div></div>`).join('');
}

function renderAllScans(scans) {
    const c = document.getElementById('allScansList');
    if (!scans.length) { c.innerHTML = '<div class="empty-state">No scans</div>'; return; }
    c.innerHTML = scans.map(s => `<div class="list-item"><div class="list-item-icon emerald"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div><div class="list-item-content"><div class="list-item-title">${s.material_name || 'Unknown'}</div><div class="list-item-subtitle">${s.ticket_date || ''} ‚Ä¢ #${s.ticket_number || 'N/A'}</div></div><div class="list-item-meta"><div class="list-item-value">+${(s.co2e_mt || 0).toFixed(2)}</div><div class="list-item-label">${s.weight_tons || 0} T</div></div></div>`).join('');
}

function renderProjectsList(projects) {
    const c = document.getElementById('projectsList');
    if (!projects.length) { c.innerHTML = '<div class="empty-state">No projects</div>'; return; }
    c.innerHTML = projects.map(p => `<div class="list-item" onclick="document.getElementById('projectSelector').value='${p.id}';switchProject();showPage('dashboard')"><div class="list-item-icon sky"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg></div><div class="list-item-content"><div class="list-item-title">${p.name}</div><div class="list-item-subtitle">${p.customers?.name || 'No customer'}</div></div><div class="list-item-meta"><span class="badge ${p.status || 'active'}">${p.status || 'active'}</span></div></div>`).join('');
}

function renderCustomersList(customers) {
    const c = document.getElementById('customersList');
    if (!customers.length) { c.innerHTML = '<div class="empty-state">No customers</div>'; return; }
    c.innerHTML = customers.map(cu => `<div class="list-item"><div class="list-item-icon purple"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg></div><div class="list-item-content"><div class="list-item-title">${cu.name}</div><div class="list-item-subtitle">${cu.company || ''} ‚Ä¢ ${cu.email || ''}</div></div></div>`).join('');
}

function updateStats(scans) {
    const co2 = scans.reduce((s, x) => s + (x.co2e_mt || 0), 0), wt = scans.reduce((s, x) => s + (x.weight_tons || 0), 0), max = currentProject?.max_co2e_target || 8000;
    document.getElementById('statCO2e').textContent = co2.toFixed(2);
    document.getElementById('statWeight').textContent = wt.toFixed(1) + ' T';
    document.getElementById('statScans').textContent = scans.length;
    document.getElementById('statDiversion').textContent = '75%';
    const circ = 2 * Math.PI * 85, pct = Math.min((co2 / max) * 100, 100), off = circ - (pct / 100) * circ;
    document.getElementById('gaugeProgress').style.strokeDasharray = circ;
    document.getElementById('gaugeProgress').style.strokeDashoffset = off;
    document.getElementById('gaugeValue').textContent = co2.toFixed(2);
    document.getElementById('gaugePercent').textContent = `${pct.toFixed(1)}% of target`;
}

// ========== SETTINGS ==========
function saveApiKey() { const k = document.getElementById('openaiKeyInput').value; if (k && k !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') { OPENAI_API_KEY = k; localStorage.setItem('divertscan_openai_key', k); document.getElementById('openaiKeyInput').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; showToast('API key saved!', 'success'); } }
async function saveOrgSettings() { if (!currentOrg) return; const n = document.getElementById('orgNameInput').value; await supabase.from('organizations').update({ name: n }).eq('id', currentOrg.id); currentOrg.name = n; showToast('Settings saved!', 'success'); }

// ========== REPORT ==========
async function generateReport() {
    if (!currentProject) return showToast('Select a project', 'error');
    const { data: scans } = await supabase.from('scans').select('*').eq('project_id', currentProject.id).order('ticket_date');
    const co2 = (scans || []).reduce((s, x) => s + (x.co2e_mt || 0), 0), wt = (scans || []).reduce((s, x) => s + (x.weight_tons || 0), 0);
    const report = `LEED v5 MRp2 Carbon Audit Report\n${'='.repeat(40)}\nProject: ${currentProject.name}\nOrg: ${currentOrg?.name || 'N/A'}\nGenerated: ${new Date().toLocaleString()}\n\nSUMMARY\n-------\nTotal CO‚ÇÇe: ${co2.toFixed(2)} MT\nTotal Weight: ${wt.toFixed(2)} tons\nTarget: ${(currentProject.max_co2e_target || 8000).toFixed(2)} MT\nProgress: ${((co2 / (currentProject.max_co2e_target || 8000)) * 100).toFixed(1)}%\nScans: ${(scans || []).length}\n\nSCAN LOG\n--------\n${(scans || []).map(s => `[${s.ticket_date || 'N/A'}] ${s.material_name || 'Unknown'} - ${s.weight_tons || 0}T - ${(s.co2e_mt || 0).toFixed(2)} MT - #${s.ticket_number || 'N/A'}`).join('\n')}\n\n${'='.repeat(40)}\nGenerated by DivertScan‚Ñ¢`;
    const blob = new Blob([report], { type: 'text/plain' }), url = URL.createObjectURL(blob), a = document.createElement('a');
    a.href = url; a.download = `DivertScan_Report_${Date.now()}.txt`; a.click(); URL.revokeObjectURL(url);
    showToast('Report downloaded!', 'info');
}

// ========== UI ==========
function showPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.getElementById('page-' + id)?.classList.add('active'); document.querySelector(`.tab[onclick="showPage('${id}')"]`)?.classList.add('active'); }
function showModal(id) { document.getElementById(id).classList.add('show'); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); currentScanResult = null; }
function showToast(msg, type = 'info') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast ' + type + ' show'; setTimeout(() => t.classList.remove('show'), 3000); }

document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
