<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DivertScanâ„¢ Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
        .debug { background: #1e293b; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .debug h3 { color: #10b981; margin-bottom: 12px; }
        .log { font-family: monospace; font-size: 12px; padding: 4px 0; border-bottom: 1px solid #334155; }
        .log.error { color: #ef4444; }
        .log.success { color: #10b981; }
        .log.info { color: #3b82f6; }
        .auth-form { background: #1e293b; border-radius: 8px; padding: 20px; max-width: 400px; margin-top: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; color: #94a3b8; margin-bottom: 6px; }
        .form-input { width: 100%; padding: 12px; background: #334155; border: 1px solid #475569; border-radius: 6px; color: white; font-size: 16px; }
        .btn { padding: 12px 20px; background: #10b981; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; }
        .btn:disabled { opacity: 0.5; }
        h1 { color: #10b981; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ”§ DivertScanâ„¢ Debug Mode</h1>
    
    <div class="debug">
        <h3>System Log</h3>
        <div id="logs"></div>
    </div>
    
    <div class="auth-form" id="authForm" style="display:none;">
        <h3 style="margin-bottom:16px;">Sign In / Sign Up</h3>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="email" placeholder="you@email.com">
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <button class="btn" id="signInBtn" onclick="signIn()">Sign In</button>
        <button class="btn" id="signUpBtn" onclick="signUp()" style="margin-top:10px;background:#3b82f6;">Sign Up</button>
    </div>
    
    <div id="appSection" style="display:none;margin-top:20px;">
        <div class="debug">
            <h3>âœ… Logged In!</h3>
            <p id="userInfo"></p>
            <button class="btn" onclick="signOut()" style="margin-top:10px;background:#ef4444;">Sign Out</button>
        </div>
    </div>

    <script>
    const SUPABASE_URL = 'https://cyvvlngtojagfoaitoog.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5dnZsbmd0b2phZ2ZvYWl0b29nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkyODk4OTAsImV4cCI6MjA4NDg2NTg5MH0.CltpTET2wFfl5kaHFOGmUS8tR8bRFCjbtWDdVrC5r0g';
    
    let supabase;
    
    function log(msg, type = 'info') {
        const logs = document.getElementById('logs');
        const div = document.createElement('div');
        div.className = 'log ' + type;
        div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
        logs.appendChild(div);
        console.log(msg);
    }
    
    async function init() {
        log('Starting initialization...', 'info');
        
        try {
            log('Checking if Supabase library loaded...', 'info');
            if (typeof window.supabase === 'undefined') {
                throw new Error('Supabase library not loaded!');
            }
            log('Supabase library loaded âœ“', 'success');
            
            log('Creating Supabase client...', 'info');
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            log('Supabase client created âœ“', 'success');
            
            log('Checking for existing session...', 'info');
            const { data, error } = await supabase.auth.getSession();
            
            if (error) {
                throw new Error('Session error: ' + error.message);
            }
            
            if (data.session) {
                log('User is logged in: ' + data.session.user.email, 'success');
                showApp(data.session.user);
            } else {
                log('No session found - showing auth form', 'info');
                document.getElementById('authForm').style.display = 'block';
            }
            
            log('Testing database connection...', 'info');
            const { data: projects, error: dbError } = await supabase.from('projects').select('count');
            if (dbError) {
                log('Database error: ' + dbError.message, 'error');
            } else {
                log('Database connection OK âœ“', 'success');
            }
            
            log('=== INIT COMPLETE ===', 'success');
            
        } catch (err) {
            log('ERROR: ' + err.message, 'error');
            console.error(err);
        }
    }
    
    async function signIn() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
            log('Please enter email and password', 'error');
            return;
        }
        
        log('Signing in...', 'info');
        
        try {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            
            if (error) throw error;
            
            log('Sign in successful!', 'success');
            showApp(data.user);
        } catch (err) {
            log('Sign in error: ' + err.message, 'error');
        }
    }
    
    async function signUp() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
            log('Please enter email and password', 'error');
            return;
        }
        
        log('Signing up...', 'info');
        
        try {
            const { data, error } = await supabase.auth.signUp({ email, password });
            
            if (error) throw error;
            
            if (data.user && !data.session) {
                log('Check your email to confirm your account!', 'info');
            } else {
                log('Sign up successful!', 'success');
                showApp(data.user);
            }
        } catch (err) {
            log('Sign up error: ' + err.message, 'error');
        }
    }
    
    async function signOut() {
        await supabase.auth.signOut();
        log('Signed out', 'info');
        document.getElementById('authForm').style.display = 'block';
        document.getElementById('appSection').style.display = 'none';
    }
    
    function showApp(user) {
        document.getElementById('authForm').style.display = 'none';
        document.getElementById('appSection').style.display = 'block';
        document.getElementById('userInfo').textContent = 'Email: ' + user.email;
    }
    
    // Start
    init();
    </script>
</body>
</html>
